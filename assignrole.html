<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="css/dataTables.bootstrap5.min.css" />
    <link rel="stylesheet" href="css/style.css" />
</head>

<body onload="viewdate()">
    <!-- top navigation bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar"
                aria-controls="offcanvasExample">
                <span class="navbar-toggler-icon" data-bs-target="#sidebar"></span>
            </button>
            <a class="navbar-brand me-auto ms-lg-0 ms-3 text-uppercase fw-bold" href="#">Human Resource Management
                Software</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#topNavBar"
                aria-controls="topNavBar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="container-sm text-end text-white text-wrap fs-6">
                Date:-<span id="date" class="fw-bold"> --/--/--</span>
                Time:-<span id="time" class="fw-bold"> --:--:--</span>
            </div>
            <div class="collapse navbar-collapse" id="topNavBar">
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle ms-2" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            <i class="bi bi-person-fill"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#">Log Out</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- top navigation bar -->
    <!-- offcanvas -->
    <div class="offcanvas offcanvas-start sidebar-nav bg-dark" tabindex="-1" id="sidebar">
        <div class="offcanvas-body p-0">
            <img src="https://www.i-scoop.eu/wp-content/uploads/2019/11/HR-transformation.jpg.webp"
                class="img-thumbnail">
            <nav class="navbar-dark">
                <ul class="navbar-nav">
                    <li>
                        <div class="text-muted small fw-bold text-uppercase px-3 mb-3 mt-3">
                            CORE
                        </div>
                    </li>
                    <li>
                        <a href="index.html" class="nav-link px-3 active">
                            <span class="me-2"><i class="bi bi-speedometer2"></i></span>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <div class="text-muted small fw-bold text-uppercase px-3 mb-3 mt-3">
                            Interface
                        </div>
                    </li>

                    <li>
                        <a class="nav-link px-3 sidebar-link" data-bs-toggle="collapse" href="#layouts">
                            <span class="me-2"><i class="bi bi-people"></i></i></span>
                            <span>Employee</span>
                            <span class="ms-auto">
                                <span class="right-icon">
                                    <i class="bi bi-chevron-down"></i>
                                </span>
                            </span>
                        </a>
                        <div class="collapse" id="layouts">
                            <ul class="navbar-nav ps-3">
                                <li>
                                    <a href="employee.html" class="nav-link px-3">
                                        <span class="me-2"><i class="bi bi-file-person"></i></span>
                                        <span>Employee Profile</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="newemployee.html" class="nav-link px-3">
                                        <span class="me-2"><i class="bi bi-person-plus"></i></span>
                                        <span>Add Employee</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="editemployee.html" class="nav-link px-3">
                                        <span class="me-2"><i class="bi bi-gear"></i></span>
                                        <span>Edit Employee</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="deleteemployee.html" class="nav-link px-3">
                                        <span class="me-2"><i class="bi bi-person-dash"></i></span>
                                        <span>Delete Employee</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>

                    <li>
                        <a class="nav-link px-3 sidebar-link" data-bs-toggle="collapse" href="#layouts2">
                            <span class="me-2"><i class="bi bi-people"></i></i></span>
                            <span>Attendance</span>
                            <span class="ms-auto">
                                <span class="right-icon">
                                    <i class="bi bi-chevron-down"></i>
                                </span>
                            </span>
                        </a>
                        <div class="collapse" id="layouts2">
                            <ul class="navbar-nav ps-3">
                                <li>
                                    <a href="#" class="nav-link px-3">
                                        <span class="me-2"><i class="bi bi-file-person"></i></span>
                                        <span>Daily Attendance</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#" class="nav-link px-3">
                                        <span class="me-2"><i class="bi bi-person-plus"></i></span>
                                        <span>Attendance Report</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a class="nav-link px-3 sidebar-link" data-bs-toggle="collapse" href="#layouts2">
                            <span class="me-2"><i class="bi bi-people"></i></i></span>
                            <span>Leave</span>
                            <span class="ms-auto">
                                <span class="right-icon">
                                    <i class="bi bi-chevron-down"></i>
                                </span>
                            </span>
                        </a>
                        <div class="collapse" id="layouts2">
                            <ul class="navbar-nav ps-3">
                                <li>
                                    <a href="#" class="nav-link px-3">
                                        <span class="me-2"><i class="bi bi-file-person"></i></span>
                                        <span>Leave Profile</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#" class="nav-link px-3">
                                        <span class="me-2"><i class="bi bi-person-plus"></i></span>
                                        <span>Leave Requistions</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#" class="nav-link px-3">
                                        <span class="me-2"><i class="bi bi-person-plus"></i></span>
                                        <span>Cancell Leave</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>

                    <li>
                        <a class="nav-link px-3 sidebar-link" data-bs-toggle="collapse" href="#layouts2">
                            <span class="me-2"><i class="bi bi-people"></i></i></span>
                            <span>Role & Department </span>
                            <span class="ms-auto">
                                <span class="right-icon">
                                    <i class="bi bi-chevron-down"></i>
                                </span>
                            </span>
                        </a>
                        <div class="collapse" id="layouts2">
                            <ul class="navbar-nav ps-3">
                                <li>
                                    <a href="#" class="nav-link px-3">
                                        <span class="me-2"><i class="bi bi-file-person"></i></span>
                                        <span>New Role</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#" class="nav-link px-3">
                                        <span class="me-2"><i class="bi bi-person-plus"></i></span>
                                        <span>Assign & Free Role</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#" class="nav-link px-3">
                                        <span class="me-2"><i class="bi bi-person-plus"></i></span>
                                        <span>Department Profile</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="#" class="nav-link px-3">
                            <span class="me-2"><i class="bi bi-book-fill"></i></span>
                            <span>PayRoll</span>
                        </a>
                    </li>
                    <li class="my-4">
                        <hr class="dropdown-divider bg-light" />
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    <!-- offcanvas -->


    <main class="mt-5 pt-3">
        <div class="container-fluid">
            <!---page content here-->
            <div class="row">
                <h3 class="hw-3">Roles Assignment Management</h3>
            </div>

            <div class="row border-top border-5 mb-2">
                <div class="col-md-9">
                    <div class="row mt-5">
                        <div class="col-md-2 mb-2">
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop"
                                onclick="GenerateRoles()">Assign</button>
                        </div>
                        <div class="col-md-2 mb-2">
                            <button class="btn btn-primary" onclick="freeRole()">Free</button>
                        </div>
                        <div class="col-md-1">
                            <button class="btn btn-primary" onclick="SwichRole()">Switch</button>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-md-12 mb-3">
                            <div class="card">
                                <div class="card-header">
                                    <span><i class="bi bi-table me-2"></i></span> Data Table
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table id="example" class="table table-striped data-table" style="width: 100%">
                                            <thead>
                                                <tr>
                                                    <th>Employee Id</th>
                                                    <th>Name</th>
                                                    <th>Position/Role</th>
                                                    <th>Free/Switch</th>
                                                </tr>
                                            </thead>
                                            <tbody id="assignmentTable">
                                                <tr id="eid102/rid145">
                                                    <td>102</td>
                                                    <td>Tiger Nixon</td>
                                                    <td>System Architect</td>
                                                    <td><input class="form-check-input" type="checkbox" id=""></td>
                                                </tr>

                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                    <th>Employee Id</th>
                                                    <th>Name</th>
                                                    <th>Position/Role</th>
                                                    <th>Free/Switch</th>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="row">
                        <p class="fs-4">Free Roles</p>
                    </div>
                    <div class="row pb-3">
                        <ul class="list-group list-group-flush" id="roles">
                            <li class="list-group-item" id="132">
                                Senior Software Engineer
                                <span class="badge bg-primary rounded-pill">1</span>
                            </li>
                            <li class="list-group-item" id="321">
                                Java Developer
                                <span class="badge bg-primary rounded-pill mx-2">2</span>
                            </li>
                            <li class="list-group-item" id="456">
                                Accountant
                                <span class="badge bg-primary rounded-pill">1</span>
                            </li>
                        </ul>
                    </div>
                    <div class="row border-top border-5 pt-3">
                        <p class="fs-4">Free Employees</p>
                    </div>
                    <div class="row">
                        <ul class="list-group list-group-flush" id="freeEmp">
                            <li class="list-group-item" id="100">
                                Ankit Borude
                            </li>
                            <li class="list-group-item" id="101">
                                Karan Bankar
                            </li>
                            <li class="list-group-item" id="102">
                                Sandesh Pawar
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5">Assign</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <label for="SelectableEmp" class="form-label">Select Employee</label>
                    <select class="form-select" id="SelectableEmp">
                        <option selected>Open this select menu</option>
                        <option value="1">One</option>
                        <option value="2">Two</option>
                        <option value="3">Three</option>
                        <option value="4">One</option>
                        <option value="5">Two</option>
                        <option value="6">Three</option>
                    </select>
                    <label for="SelectableRole" class="form-label mt-2">Select Role</label>
                    <select class="form-select" id="SelectableRole">
                        <option selected>Open this select menu</option>
                        <option value="1">One</option>
                        <option value="2">Two</option>
                        <option value="3">Three</option>
                        <option value="4">One</option>
                        <option value="5">Two</option>
                        <option value="6">Three</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success" data-bs-dismiss="modal"
                        onclick="AssignRole()">Assign</button>
                </div>
            </div>
        </div>
    </div>

    <script src="./js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.2/dist/chart.min.js"></script>
    <script src="./js/jquery-3.5.1.js"></script>
    <script src="./js/jquery.dataTables.min.js"></script>
    <script src="./js/dataTables.bootstrap5.min.js"></script>
    <script src="./js/script.js"></script>
    <script src="./js/time.js"></script>
    <script>
        setInterval(updateClock, 1000 * 60);
        function GenerateRoles() {  //copies the value of roles and employees into modal form
            let froles = document.getElementById("roles");//here the options of select element has
            //id of its own id
            let femp = document.getElementById("freeEmp");

            let freeRoleslist = froles.getElementsByTagName("li");
            let freeEmployeelist = femp.getElementsByTagName("li");

            let SelectableEmp = document.getElementById("SelectableEmp");
            let SelectableRole = document.getElementById("SelectableRole");
            removeAllChildNodes(SelectableEmp);
            removeAllChildNodes(SelectableRole);//removing all childs
            for (let i = 0; i < freeRoleslist.length; i++) {
                let option = document.createElement("option");
                option.setAttribute("id", "rid" + freeRoleslist[i].id);
                let text = document.createTextNode(freeRoleslist[i].firstChild.nodeValue);
                option.appendChild(text);
                SelectableRole.appendChild(option);
            }
            for (let i = 0; i < freeEmployeelist.length; i++) {
                let option = document.createElement("option");
                let text = document.createTextNode(freeEmployeelist[i].firstChild.nodeValue);
                option.setAttribute("id", "eid" + freeEmployeelist[i].id);
                option.appendChild(text);
                SelectableEmp.appendChild(option);
            }
        }
        function removeAllChildNodes(parent) {//function to remove all childs of given parent element
            while (parent.firstChild) {
                parent.removeChild(parent.firstChild);
            }
        }
        function AssignRole()//assigning role 
        {
            let emp = document.getElementById("SelectableEmp").selectedOptions;//passing selected elements collection
            let role = document.getElementById("SelectableRole").selectedOptions;
            addRecordtoTable(emp, role);//updating table
            deleteFromfreeRoles(role);
            deleteFromfreeEmployees(emp);
        }
        function freeRole() {
            let tablebody = document.getElementById("assignmentTable");
            let allcheckboxes = document.getElementsByTagName("input");
            let j = 0;
            let CheckedCheckboxarray = [];
            for (let i = 0; i < allcheckboxes.length; i++) {
                if (allcheckboxes[i].checked == true) {
                    console.log("checked");
                    CheckedCheckboxarray[j] = allcheckboxes[i];
                    j++;
                }
            }
            for (let i = 0; i < CheckedCheckboxarray.length; i++) {
                let tablerow = CheckedCheckboxarray[i].parentNode.parentNode;
                console.log(tablerow.id.split("/"));
                let ids = tablerow.id.split("/");
                let eid = ids[0].slice(3);
                let rid = ids[1].slice(3);
                let ename = tablerow.getElementsByTagName("td")[1].innerText;
                let rname = tablerow.getElementsByTagName("td")[2].innerText;
                addTofreeEmployees(eid, ename);
                addTofreeRoles(rid, rname);
                console.log(tablerow);
                deletefromRecordTable(tablerow);
            }
        }
        function SwichRole() {

            let tablebody = document.getElementById("assignmentTable");
            let allcheckboxes = document.getElementsByTagName("input");
            let j = 0;
            let CheckedCheckboxarray = [];
            for (let i = 0; i < allcheckboxes.length; i++) {
                if (allcheckboxes[i].checked == true) {
                    console.log("checked");
                    CheckedCheckboxarray[j] = allcheckboxes[i];
                    j++;
                }
            }
            if (CheckedCheckboxarray.length > 2 || CheckedCheckboxarray.length==1) {
                return false;
            }
            let tablerow1 = CheckedCheckboxarray[0].parentNode.parentNode;
            let tablerow2 = CheckedCheckboxarray[1].parentNode.parentNode;
            let ids1 = tablerow1.id.split("/");
            let eid1 = ids1[0];
            let rid1 = ids1[1];

            let ids2 = tablerow2.id.split("/");
            let eid2 = ids2[0];
            let rid2 = ids2[1];

            let newid1 = eid1 + "/" + rid2;
            let newid2 = eid2 + "/" + rid1;

            let rname1 = tablerow1.getElementsByTagName("td")[2].innerText;
            let rname2 = tablerow2.getElementsByTagName("td")[2].innerText;
            tablerow1.getElementsByTagName("td")[2].innerText = rname2;
            tablerow2.getElementsByTagName("td")[2].innerText = rname1;
            tablerow1.id = newid1;
            tablerow2.id = newid2;
            return true;
        }
        function addRecordtoTable(...args)//empid,enamae,role
        {
            let tablebody = document.getElementById("assignmentTable");
            let tablerow = document.createElement("tr");
            for (let i = 0; i < args.length; i++) {
                if (i == 0) {
                    let td = document.createElement("td");
                    let idtextdata = document.createTextNode((args[i][0].id).slice(3));
                    td.appendChild(idtextdata);
                    let td2 = document.createElement("td");
                    let nametextdata = document.createTextNode(args[i][0].value);
                    td2.appendChild(nametextdata);
                    tablerow.appendChild(td);
                    tablerow.appendChild(td2);
                }
                else {
                    let td = document.createElement("td");
                    let textdata = document.createTextNode(args[i][0].value);
                    td.appendChild(textdata);
                    tablerow.appendChild(td);
                }
                tablerow.setAttribute("id", args[0][0].id + "/" + args[1][0].id);//assigning employee id to table row
            }
            let td = document.createElement("td");
            let input = document.createElement("input");
            input.setAttribute("class", "form-check-input");
            input.setAttribute("type", "checkbox");
            td.appendChild(input);
            tablerow.appendChild(td);
            tablebody.appendChild(tablerow);
        }
        function addTofreeRoles(roleid, rolename) {

            let froles = document.getElementById("roles");
            let allrolesli = froles.getElementsByTagName("li");
            let flag = 1;
            for (let i = 0; i < allrolesli.length; i++) {
                if ((allrolesli[i].id) == roleid) {
                    let badge = allrolesli[i].getElementsByTagName("span");
                    let totalPositions = badge[0].innerText;
                    badge[0].innerText = ++totalPositions;
                    flag = 0;
                    break;
                }
            }
            if (flag == 1) {
                let li = document.createElement("li");
                li.setAttribute("id", roleid);
                li.setAttribute("class", "list-group-item");
                let textrolename = document.createTextNode(rolename);
                let span = document.createElement("span");
                span.setAttribute("class", "badge bg-primary rounded-pill");
                let totalrole = document.createTextNode("1");
                span.appendChild(totalrole);
                li.appendChild(textrolename);
                li.appendChild(span);
                froles.appendChild(li);
            }

        }
        function deleteFromfreeRoles(selectedOp) {
            let roleId = selectedOp[0].id.slice(3);
            let li = document.getElementById(roleId);
            let badge = li.getElementsByTagName("span");
            let totalPositions = badge[0].innerText;
            if (totalPositions < 2) {
                let parentul = li.parentNode;
                parentul.removeChild(li);
            }
            else {
                badge[0].innerText = --totalPositions;
            }

        }
        function addTofreeEmployees(eid, ename) {
            let femp = document.getElementById("freeEmp");
            let li = document.createElement("li");
            li.setAttribute("id", eid);
            li.setAttribute("class", "list-group-item");
            let textrolename = document.createTextNode(ename);
            li.appendChild(textrolename);
            femp.appendChild(li);
        }
        function deletefromRecordTable(row) {
            let tablebody = row.parentNode;
            tablebody.removeChild(row);
        }
        function deleteFromfreeEmployees(selectedOp) {
            let eId = selectedOp[0].id.slice(3);
            let li = document.getElementById(eId);
            let parentul = li.parentNode;
            parentul.removeChild(li);
        }
    </script>
</body>

</html>